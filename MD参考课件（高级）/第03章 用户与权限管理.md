# 1. 用戶管理
## 1.1 登录MySQL服务器
### 🔐 一、什麼是「登錄 MySQL 伺服器」？

這個動作指的是：
> 使用帳號密碼，透過命令列工具 `mysql` 連接到正在運行的 MySQL 服務（通常在本機或遠端伺服器上）。

你可以透過「本機連線」或「遠端連線」兩種方式進行登錄。

---

### 📌 二、登錄指令語法說明

#### 基本語法：

```bash
mysql -h hostname -P port -u username -p DatabaseName -e "SQL語句"
```

| 參數 | 說明 |
|------|------|
| `-h hostname` | 指定伺服器主機名稱或 IP，預設是 `localhost` |
| `-P port` | 指定連接埠，預設是 `3306` |
| `-u username` | 指定用戶名稱，例如 `root` |
| `-p` | 要求輸入密碼（執行後會提示） |
| `DatabaseName` | 登錄後自動使用的資料庫名稱（可選） |
| `-e "SQL語句"` | 登錄後直接執行 SQL 指令並顯示結果 |

---

### 🧪 三、範例操作與解說

#### ✅ 範例 1：最簡單的登入（本機、預設資料庫）

```bash
mysql -u root -p
```

這會：
- 登錄本機 `localhost`
- 使用 `root` 帳號
- 提示輸入密碼
- 成功後會進入 MySQL 命令列互動模式（類似 REPL）

---

#### ✅ 範例 2：登入並使用 `mysql` 資料庫

```bash
mysql -u root -p mysql
```

這會：
- 登錄 MySQL 並自動選擇 `mysql` 資料庫

---

#### ✅ 範例 3：登入後直接查詢 `user` 表中的資料

```bash
mysql -u root -p -h localhost -P 3306 mysql -e "SELECT Host, User FROM user;"
```

這會：
- 使用 root 帳號、密碼
- 連接本機的 3306 埠
- 指定使用 `mysql` 資料庫
- 查詢該資料庫下的 `user` 表，並印出 `Host` 和 `User` 欄位的值
- 執行完後**不會進入互動模式**，而是直接退出

---

#### ✅ 範例 4：登入遠端 MySQL 伺服器

```bash
mysql -h 192.168.1.100 -u admin -p
```

這會：
- 登入位於 `192.168.1.100` 的 MySQL 伺服器
- 使用帳號 `admin`
- 提示輸入密碼

---

### 🔐 四、密碼的輸入方式（注意事項）

- `-p` 後面**不能直接加密碼**（不安全，也會報錯）
- 正確方式是執行後讓系統提示你輸入密碼

錯誤方式（不建議）：
```bash
mysql -u root -p123456  ❌
```

---

### 🛠️ 五、常見錯誤處理

| 錯誤訊息 | 可能原因 |
|----------|----------|
| `Access denied for user` | 密碼錯誤或用戶沒有權限 |
| `Can't connect to MySQL server` | IP、Port 或服務未啟動 |
| `Unknown database` | 指定的資料庫不存在 |

---

## 1.2 創建用戶
### ✅ 一、什麼是 `CREATE USER`

`CREATE USER` 是 MySQL 中用來**新增帳號（用戶）**的語句，讓指定的帳號可以從某個主機登入 MySQL。

用戶帳號的格式為：

```
'使用者名稱'@'主機位址'
```

- **使用者名稱（User）**：帳號的名稱
- **主機位址（Host）**：限制此帳號從哪裡可以連線，常見值：
  - `'localhost'`：只能從本機連線
  - `'%'`：允許從任何主機連線（較危險）
  - `'192.168.1.100'`：只能從指定 IP 連線

---

### 🧱 二、語法格式

```sql
CREATE USER '使用者名稱'@'主機位址' IDENTIFIED BY '密碼';
```

可一次建立多個使用者：

```sql
CREATE USER 
  'user1'@'localhost' IDENTIFIED BY 'pwd1',
  'user2'@'%' IDENTIFIED BY 'pwd2';
```

---

### 🧪 三、範例解說

#### ✅ 範例 1：建立一個本機使用者

```sql
CREATE USER 'alice'@'localhost' IDENTIFIED BY 'securePwd123';
```

📌 表示使用者 `alice` 只能從 **本機** 登入 MySQL，登入時需要輸入密碼 `securePwd123`。

---

#### ✅ 範例 2：建立一個遠端用戶

```sql
CREATE USER 'devuser'@'%' IDENTIFIED BY 'devpass';
```

📌 表示 `devuser` 可以從**任何主機**登入（前提是防火牆與權限允許），使用密碼 `devpass`。

---

#### ✅ 範例 3：一次建立多個使用者

```sql
CREATE USER 
  'admin1'@'localhost' IDENTIFIED BY 'adminpwd1',
  'admin2'@'192.168.0.100' IDENTIFIED BY 'adminpwd2';
```

📌 表示建立兩個帳號，且從不同主機登入 MySQL。

---

#### ✅ 範例 4：建立一個不設密碼的使用者（⚠️不建議）

```sql
CREATE USER 'nopwduser'@'localhost';
```

📌 此使用者登入時不需密碼，**安全性很差**，僅用於測試環境！

---

### 🔐 四、建立用戶 ≠ 立即有操作權限

建立完帳號後，該用戶**預設沒有任何權限**。你還需要配合 `GRANT` 給他權限，例如：

```sql
GRANT ALL PRIVILEGES ON mydb.* TO 'alice'@'localhost';
```

📌 這樣 alice 才能對 `mydb` 資料庫執行操作（查詢、插入、更新、刪除等）。

---

### 🧹 五、查看與刪除用戶

#### 查看所有用戶：

```sql
SELECT user, host FROM mysql.user;
```

#### 刪除用戶：

```sql
DROP USER 'alice'@'localhost';
```

---

## 1.3 修改用户
### ✅ 一、什麼是「MySQL 修改用戶」

修改用戶通常指：

1. **修改用戶名稱（RENAME）**
2. **修改登入主機（HOST）**
3. **修改密碼**
4. **修改用戶資訊（例如 plugin、authentication_string）**

---

### 🧠 二、不推薦的方式：直接操作 `mysql.user` 表

你提供的語法如下：

```sql
UPDATE mysql.user SET USER='li4' WHERE USER='wang5'; 
FLUSH PRIVILEGES;
```

這樣雖然能把 `wang5` 改成 `li4`，但：
- 這是直接操作 **系統資料表**
- 可能導致權限資訊混亂或無效
- **MySQL 8.0 起**，很多欄位已改變，不建議這樣做

> ✅ 建議使用官方提供的語法：`RENAME USER`、`ALTER USER`

---

### 🛠️ 三、正確做法：使用 RENAME USER 語句

#### ✅ 修改用戶名稱：

```sql
RENAME USER 'wang5'@'localhost' TO 'li4'@'localhost';
```

📌 表示將 `wang5@localhost` 改為 `li4@localhost`，權限會保留。

---

### 🔑 四、修改密碼的方式

#### ✅ MySQL 5.7 以前：

```sql
SET PASSWORD FOR 'li4'@'localhost' = PASSWORD('newpassword');
```

#### ✅ MySQL 5.7+ 或 8.0：

```sql
ALTER USER 'li4'@'localhost' IDENTIFIED BY 'newpassword';
```

---

### 🌐 五、修改 Host（登入來源）

MySQL **不支援直接修改用戶的 Host**，你需要刪除並重新建立：

```sql
-- 複製原帳號的權限給新帳號
CREATE USER 'li4'@'%' IDENTIFIED BY 'mypwd';
GRANT ALL PRIVILEGES ON *.* TO 'li4'@'%';

-- 刪除原帳號
DROP USER 'li4'@'localhost';
```

---

### 🧪 六、綜合範例：更名 + 修改密碼

```sql
RENAME USER 'olduser'@'localhost' TO 'newuser'@'localhost';
ALTER USER 'newuser'@'localhost' IDENTIFIED BY 'NewPass123';
```

---

### 🧹 七、補充說明：FLUSH PRIVILEGES 是什麼？

當你 **直接更新 mysql.user 表** 時，需要：

```sql
FLUSH PRIVILEGES;
```

👉 它的意思是「**讓 MySQL 重新讀取用戶權限表**」，否則你修改的內容不會立即生效。

> 但如果你使用的是 `ALTER USER` 或 `RENAME USER` 等語句，就不需要這行，因為它們會自動刷新權限。

---

## 1.4 刪除用戶
### ✅ 一、MySQL 刪除用戶的目的

刪除用戶的主要目的是：

- 移除不再需要的帳號
- 防止未授權使用者存取資料庫
- 清理系統中的無效帳號

---

### 🔐 二、方式一：使用 `DROP USER`（✅推薦方式）

#### ⭐ 語法：

```sql
DROP USER '用戶名'@'主機';
```

- 可以同時刪多個帳號，用逗號分隔
- 會一併刪除該用戶在 `mysql.user`、`mysql.db` 等權限表中的紀錄
- 不需手動 `FLUSH PRIVILEGES`，會自動刷新

#### ✅ 範例 1：刪除本機帳號

```sql
DROP USER 'li4'@'localhost';
```

#### ✅ 範例 2：刪除預設 `%` 主機（任何位置登入）

```sql
DROP USER 'li4';
-- 等同於 'li4'@'%'
```

#### ✅ 範例 3：一次刪除多個使用者

```sql
DROP USER 'li4'@'localhost', 'emily'@'192.168.1.5';
```

---

### 🚫 三、方式二：使用 `DELETE FROM mysql.user`（❌不建議）

#### ⚠️ 不推薦的原因：

- 這只是從 `mysql.user` 表刪除資料
- **不會自動清除其它權限表（如 mysql.db、mysql.tables_priv）**
- 容易導致資料庫內仍殘留該用戶的權限記錄，造成系統異常或資安風險
- **必須手動 `FLUSH PRIVILEGES`** 使更動生效

#### 🧨 語法：

```sql
DELETE FROM mysql.user WHERE User='Emily' AND Host='localhost';
FLUSH PRIVILEGES;
```

---

### 👀 四、查詢目前有哪些使用者

在刪除之前，你可以先列出有哪些帳號：

```sql
SELECT User, Host FROM mysql.user;
```

這樣可以確保你刪除的是正確帳號（尤其是當同一個使用者名稱有不同 Host 時）

---

### 🧹 五、如果你忘記 Host 是什麼？

查詢 user 表時，觀察該用戶對應的 Host：

```sql
SELECT Host, User FROM mysql.user WHERE User = 'li4';
```

---

### 🔄 六、常見補充：忘記 DROP USER 怎麼辦？

如果你用 DELETE 誤刪某個帳號導致權限錯亂，可採用以下修復方式：

```sql
-- 重建帳號
CREATE USER 'li4'@'localhost' IDENTIFIED BY 'mypassword';

-- 重新授權
GRANT ALL PRIVILEGES ON *.* TO 'li4'@'localhost';

-- 最後如果需要刪除，使用正確方式刪除
DROP USER 'li4'@'localhost';
```

---

### ✅ 總結建議

| 操作方式 | 安全性 | 是否自動清除權限 | 需手動刷新 | 建議用途 |
|----------|--------|------------------|-------------|-----------|
| `DROP USER` | ✅ 安全 | ✅ 是 | ❌ 否 | 日常操作 |
| `DELETE FROM mysql.user` | ❌ 不安全 | ❌ 否 | ✅ 是 | 除錯或緊急用，**需小心** |

---

## 1.5 設置當前用戶密碼
### ✅ 一、為什麼要設定目前用戶的密碼？

MySQL 中密碼是用來保護資料庫安全的第一道防線，尤其是像 `root` 這樣的超級帳號，若沒有妥善設置密碼，很容易造成重大資安風險。

常見的修改情境：
- 初次安裝 MySQL，root 沒有密碼
- 忘記密碼後重設
- 定期變更密碼（安全政策）

---

### 📌 二、版本差異說明（重要）

| MySQL 版本 | 是否支援 PASSWORD() | 推薦語法                |
|-------------|---------------------|--------------------------|
| < 5.7        | ✅ 使用 PASSWORD() | `SET PASSWORD = PASSWORD('...')` |
| ≥ 5.7        | ⚠️ 慢慢棄用         | `ALTER USER` or `SET PASSWORD` |
| ≥ 8.0        | ❌ 移除 PASSWORD() | ✅ `ALTER USER` 是官方推薦 |

---

### 🛠️ 三、推薦方式：修改「當前使用者」密碼

#### ✅ 方法 1：使用 `ALTER USER`（官方推薦）

```sql
ALTER USER USER() IDENTIFIED BY 'NewSecurePassword!';
```

🔎 解說：
- `USER()` 是一個內建函數，會自動回傳目前登入帳號（例如 `'root'@'localhost'`）
- 此語句會修改「目前登入帳號」的密碼

📌 **MySQL 5.7+ 推薦使用，MySQL 8.0 更是唯一推薦方式**

---

#### ✅ 方法 2：使用 `SET PASSWORD`（次推薦）

```sql
SET PASSWORD = 'NewSecurePassword!';
```

🔎 解說：
- 會自動加密密碼
- 不需要指定帳號，修改目前使用者密碼

📌 **MySQL 5.7+ 可用，8.0 中仍可用，但不如 `ALTER USER` 明確**

---

### ❌ 四、不再推薦的舊方法（MySQL 5.7 以前用）

```sql
SET PASSWORD = PASSWORD('NewSecurePassword!');
```

或

```sql
UPDATE mysql.user SET authentication_string = PASSWORD('NewSecurePassword!') WHERE User = 'xxx';
FLUSH PRIVILEGES;
```

📌 缺點：
- 需要直接操作系統資料表 `mysql.user`
- 容易造成殘留問題或版本相容性錯誤
- **MySQL 8.0 已移除 `PASSWORD()` 函數**

---

### 🧪 五、完整範例

#### 💻 登入 MySQL

```bash
mysql -u root -p
```

#### ✅ 修改當前用戶密碼（強烈推薦）

```sql
ALTER USER USER() IDENTIFIED BY 'MyNewP@ssw0rd!';
```

或者：

```sql
SET PASSWORD = 'MyNewP@ssw0rd!';
```

#### 🔐 修改成功後可重新登入驗證：

```bash
mysql -u root -p
# 輸入剛剛新設的密碼登入
```

---

### 🧠 六、補充：如果你是 root，要幫其他人改密碼

你也可以這樣指定帳號來修改：

```sql
ALTER USER 'alice'@'localhost' IDENTIFIED BY 'AliceSecure123';
```

---

### ✅ 總結比較

| 方法 | 是否支援 MySQL 8.0 | 是否推薦 | 是否需指定用戶 | 是否自動加密 |
|------|----------------------|-----------|------------------|----------------|
| `ALTER USER USER()` | ✅ 是 | ✅ 非常推薦 | ❌ 不需指定 | ✅ |
| `SET PASSWORD = ...` | ✅ 是 | ✅ 可接受 | ❌ 不需指定 | ✅ |
| `SET PASSWORD = PASSWORD(...)` | ❌ 不支援 | ❌ 不推薦 | ❌ | ✅ |
| `UPDATE mysql.user` | ❌ 不支援 | ❌ 強烈不建議 | ✅ 要指定 | ⚠️ 不保證 |

---

## 1.6 修改其他用戶密碼
### ✅ 一、誰可以修改其他用戶的密碼？

- ✅ **`root`**（或擁有 `ALTER USER`、`UPDATE` 權限的管理員）才可以修改其他帳號的密碼。
- 普通用戶**只能改自己的密碼**，不能改別人的。

---

### 📌 二、推薦的方式一：使用 `ALTER USER`（✅MySQL 官方建議）

#### 🔧 語法格式：
```sql
ALTER USER 'username'@'host' IDENTIFIED BY 'new_password';
```

- `username`：使用者帳號
- `host`：該帳號可連線的主機（如 `localhost`, `%`）
- `new_password`：新密碼（會自動加密）

---

#### ✅ 範例：修改 `kangshifu@localhost` 的密碼為 `HelloWorld_123`

```sql
ALTER USER 'kangshifu'@'localhost' IDENTIFIED BY 'HelloWorld_123';
```

也可以一次改多個帳號：

```sql
ALTER USER 
  'alice'@'localhost' IDENTIFIED BY 'Alice123!',
  'bob'@'%' IDENTIFIED BY 'Bob456!';
```

📌 **適用於 MySQL 5.7+ 與 8.0，安全、標準、會自動刷新權限**

---

### 📌 三、推薦的方式二：使用 `SET PASSWORD FOR`（也可行）

#### 🔧 語法格式：

```sql
SET PASSWORD FOR 'username'@'host' = 'new_password';
```

#### ✅ 範例：

```sql
SET PASSWORD FOR 'kangshifu'@'localhost' = 'HelloWorld_123';
```

📌 同樣會自動加密密碼，但部分版本不支援一次設定多個帳號

---

### ⚠️ 四、不推薦的方式三：直接 UPDATE `mysql.user`（舊版使用）

#### ❌ 為什麼不推薦？

- MySQL 8.0 **已移除** `PASSWORD()` 函數
- 直接操作系統表可能導致權限異常或遺留資料
- 需要 `FLUSH PRIVILEGES` 手動刷新
- 不會更新與帳號相關的其他資訊（plugin、expiry 等）

---

#### ⚠️ 舊範例（5.5 ~ 5.7 可用，不支援 8.0）：

```sql
UPDATE mysql.user 
SET authentication_string = PASSWORD('123456') 
WHERE User = 'li4' AND Host = 'localhost';

FLUSH PRIVILEGES;
```

MySQL 5.5 以前可能還使用：

```sql
UPDATE mysql.user 
SET Password = PASSWORD('123456') 
WHERE User = 'li4';
```

---

### 🧠 五、如何確認修改成功？

你可以用以下語法查詢該帳號是否存在：

```sql
SELECT User, Host FROM mysql.user WHERE User = 'kangshifu';
```

若要確認是否有登入成功，可以嘗試使用該新密碼登入：

```bash
mysql -u kangshifu -p
# 然後輸入新密碼 HelloWorld_123
```

---

### ✅ 六、總結：三種方式比較

| 方法                     | 是否推薦 | 是否支援 MySQL 8 | 是否需刷新 | 說明 |
|--------------------------|-----------|-------------------|--------------|------|
| `ALTER USER`             | ✅ 強烈推薦 | ✅ 是            | ❌ 否         | 最安全、標準，支援多用戶 |
| `SET PASSWORD FOR`       | ✅ 可接受   | ✅ 是            | ❌ 否         | 次佳選擇，簡潔明確 |
| `UPDATE mysql.user`      | ❌ 不建議   | ❌ 不支援       | ✅ 需要        | 舊式操作，容易殘留問題 |

---

## 1.7 MySQL8密码管理
### 1.7.1 密码过期策略
### 🧠 一、什麼是 MySQL 密碼過期策略？

MySQL 提供了密碼過期機制，以提升安全性。透過這個策略，系統可要求使用者定期更換密碼，避免因長期未變更密碼導致帳號遭駭的風險。

密碼過期策略可分為兩種：

| 類型 | 應用範圍 | 舉例說明 |
|------|------------|----------|
| **全局策略** | 套用到所有使用者（除非另行指定） | 密碼每 180 天過期 |
| **個別策略** | 針對特定使用者設置不同的過期條件 | 指定 `kangshifu` 每 90 天過期 |

---

### 🛠 二、實作方式說明與範例

#### 1️⃣ 手動立即讓密碼過期

讓某個帳號的密碼「馬上」過期，用於強制要求使用者下次登入時重設密碼。

```sql
ALTER USER 'kangshifu'@'localhost' PASSWORD EXPIRE;
```

💡 **效果**：
- 使用者可以登入，但不能執行查詢等操作，必須先更新密碼。

---

#### 2️⃣ 設定全局密碼過期策略（適用所有用戶）

MySQL 的變數 `default_password_lifetime` 控制密碼多久會自動過期。

##### 方式 1：使用 SQL 動態設置並持久化
```sql
SET PERSIST default_password_lifetime = 180;
```

##### 方式 2：直接編輯設定檔 `my.cnf`
```ini
[mysqld]
default_password_lifetime = 180
```

📌 **補充說明**：
- 預設值為 `0`，表示密碼永不過期。
- 一旦啟用，未指定特殊規則的帳戶都會受到影響。

---

#### 3️⃣ 為個別帳戶設定密碼過期時間

##### ✅ 設定某帳號每 90 天過期
```sql
ALTER USER 'kangshifu'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;
```

##### ✅ 永不過期
```sql
ALTER USER 'kangshifu'@'localhost' PASSWORD EXPIRE NEVER;
```

##### ✅ 套用全局策略（預設）
```sql
ALTER USER 'kangshifu'@'localhost' PASSWORD EXPIRE DEFAULT;
```

💡 注意：你也可以在 `CREATE USER` 時直接加上這些設定。

---

### ✅ 三、練習範例（模擬場景）

#### 🎯 目標：強制 kangshifu 在 90 天內需改密碼一次，但目前先讓他馬上更新密碼

```sql
-- 1. 設定 kangshifu 每 90 天需改密碼
ALTER USER 'kangshifu'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;

-- 2. 強制 kangshifu 立刻重新設定密碼
ALTER USER 'kangshifu'@'localhost' PASSWORD EXPIRE;
```

#### 🔐 使用者登入後須執行：
```sql
SET PASSWORD = 'NewSecurePass@2024';
```

---

### 🧩 四、其他補充知識

| 名稱 | 說明 |
|------|------|
| `PASSWORD EXPIRE` | 密碼立即過期 |
| `PASSWORD EXPIRE INTERVAL N DAY` | N 天後過期 |
| `PASSWORD EXPIRE NEVER` | 永不過期（不推薦） |
| `default_password_lifetime` | 控制全局過期天數（需 MySQL 5.7+） |
| `SET PASSWORD FOR` | 用於手動變更密碼 |

---

### 1.7.2密码重用策略
### 🔐 一、什麼是密碼重用策略？

密碼重用策略是 **防止使用者重複使用舊密碼** 的一種安全機制。此策略能有效防止用戶將密碼改來改去卻都差不多，進而減少被暴力破解或社交工程攻擊的風險。

MySQL 從 8.0 開始支持兩種密碼重用控制方式：

| 策略類型 | 說明 |
|----------|------|
| **依照次數限制（password_history）** | 限制新密碼不能與最近 N 次使用過的密碼相同 |
| **依照時間限制（password_reuse_interval）** | 限制新密碼不能與「最近 N 天內」使用過的密碼相同 |

> 兩種可以單獨使用，也可以同時設定。

---

### 🛠️ 二、設定方式與範例

#### ✅ 方式一：設定 **全局密碼重用限制**

##### 🧩 方法 1：SQL 方式設定（並永久生效）
```sql
SET PERSIST password_history = 6;               -- 限制不可與最近 6 次使用的密碼相同
SET PERSIST password_reuse_interval = 365;      -- 限制不可重複使用一年內曾用過的密碼
```

##### 🧩 方法 2：my.cnf 中設定（伺服器啟動時套用）
```ini
[mysqld]
password_history = 6
password_reuse_interval = 365
```

> 若兩者皆設，則必須同時滿足兩者條件才能變更密碼。

---

#### ✅ 方式二：針對「單一使用者」設定密碼重用策略

##### 🚫 禁止使用最近 5 次使用過的密碼
```sql
ALTER USER 'kangshifu'@'localhost' PASSWORD HISTORY 5;
```

##### 🕒 禁止重複使用 365 天內的密碼
```sql
ALTER USER 'kangshifu'@'localhost' PASSWORD REUSE INTERVAL 365 DAY;
```

##### 🔒 結合兩者：5 次 + 365 天內均不可重複
```sql
ALTER USER 'kangshifu'@'localhost' 
  PASSWORD HISTORY 5 
  PASSWORD REUSE INTERVAL 365 DAY;
```

---

### 💡 三、實務場景理解（模擬）

#### 🧪 模擬操作

```sql
-- 建立帳號 kangshifu 並設定密碼重用限制
CREATE USER 'kangshifu'@'localhost'
  IDENTIFIED BY 'Password@2023'
  PASSWORD HISTORY 3
  PASSWORD REUSE INTERVAL 180 DAY;

-- 使用者第一次變更密碼
SET PASSWORD FOR 'kangshifu'@'localhost' = 'Password@2024';

-- 第二次變更
SET PASSWORD FOR 'kangshifu'@'localhost' = 'Password@2025';

-- 第三次變更（想用 Password@2023）
SET PASSWORD FOR 'kangshifu'@'localhost' = 'Password@2023'; 
-- ❌ 錯誤！此密碼在最近三次中出現過，且 180 天內也曾用過，不能重複使用
```

---

### 📌 四、其他補充資訊

| 系統變數 | 功能 | 預設值 |
|-----------|------|--------|
| `password_history` | 密碼歷史記錄次數 | 0（不限制） |
| `password_reuse_interval` | 密碼可重用的最小時間 | 0（不限制） |

---

### ✅ 五、實務建議

- 🧱 建議在 **企業環境** 中設為全局預設策略，統一控管密碼使用行為。
- 🧑‍💼 對於重要帳號（如 `root` 或 DBA）可以設定更嚴格的個別策略。
- 🛡️ 配合「密碼複雜度規則」與「過期策略」能形成一套完整密碼政策。

---

# 2. 權限管理
> 关于 MySQL 的权限简单的理解就是 MySQL 允许你做你权力以内的事情，不可以越界。比如只允许你执行SELECT操作，那么你就不能执行UPDATE操作。只允许你从某台机器上连接MySQL，那么你就不能从除那台机器以外的其他机器连接 MySQL。

## 2.1 權限列表
### 🔐 一、MySQL 常見權限一覽（補充完整）

你可以使用以下語法查看目前系統支援的權限：

```sql
SHOW PRIVILEGES;
```

這個指令會列出所有 GRANT/REVOKE 中可用的權限類型。以下是依功能分類後的詳細說明：

| 權限名稱 | 說明 |
|----------|------|
| **ALL [PRIVILEGES]** | 授與所有可用的權限（不包含 GRANT OPTION） |
| **SELECT** | 查詢表中資料 |
| **INSERT** | 插入新資料 |
| **UPDATE** | 修改已有資料 |
| **DELETE** | 刪除資料 |
| **CREATE** | 建立新資料庫、表、索引、儲存程序等 |
| **DROP** | 刪除資料庫、表、索引、儲存程序等 |
| **RELOAD** | 使伺服器重新載入快取、權限表等（用於 `FLUSH`） |
| **SHUTDOWN** | 關閉 MySQL 伺服器 |
| **PROCESS** | 查看執行中的查詢（用於 `SHOW PROCESSLIST`） |
| **FILE** | 允許從伺服器本地檔案系統讀寫（如 `LOAD DATA`） |
| **GRANT OPTION** | 允許將本身具有的權限授予其他使用者 |
| **REFERENCES** | 創建外鍵時使用 |
| **INDEX** | 創建或刪除索引 |
| **ALTER** | 修改表的結構 |
| **CREATE TEMPORARY TABLES** | 建立臨時表 |
| **LOCK TABLES** | 鎖定表以進行控制（如只讀） |
| **EXECUTE** | 執行儲存程序或函式 |
| **CREATE VIEW** | 建立視圖 |
| **SHOW VIEW** | 查詢視圖定義 |
| **CREATE ROUTINE** | 建立儲存程序或函式 |
| **ALTER ROUTINE** | 更改或刪除儲存程序或函式 |
| **EVENT** | 建立、刪除或執行事件 |
| **TRIGGER** | 建立或移除觸發器 |
| **CREATE USER** | 建立新使用者 |
| **SUPER** | 執行某些管理指令（如 `SET GLOBAL`） |
| **REPLICATION SLAVE** | 用於主從複製（讀取 binlog） |
| **REPLICATION CLIENT** | 查詢複製狀態 |
| **USAGE** | 代表沒有特別權限，可登入使用者 |

---

### 📂 二、MySQL 權限的作用範圍（分層）

| 層級 | 權限適用範圍 | 例子 |
|------|--------------|------|
| **全域** | 整個 MySQL Server | `GRANT ALL ON *.* TO 'user'@'host';` |
| **資料庫** | 指定資料庫 | `GRANT SELECT ON mydb.* TO 'user'@'host';` |
| **資料表** | 資料庫中的某張表 | `GRANT INSERT ON mydb.users TO 'user'@'host';` |
| **欄位** | 某資料表的欄位 | `GRANT SELECT(name) ON mydb.users TO 'user'@'host';` |
| **儲存程序 / 函式** | 指定儲存程序、觸發器、事件等 | `GRANT EXECUTE ON PROCEDURE mydb.myproc TO 'user'@'host';` |

---

### 💡 三、GRANT 和 REVOKE 語法範例

#### 🔹 1. 建立使用者
```sql
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'password123';
```

#### 🔹 2. 賦予權限
```sql
-- 賦予 SELECT、INSERT 權限給 app_user 對某資料庫
GRANT SELECT, INSERT ON shop_db.* TO 'app_user'@'localhost';

-- 賦予執行儲存程序的權限
GRANT EXECUTE ON PROCEDURE shop_db.recalculate_totals TO 'app_user'@'localhost';

-- 賦予 GRANT 權限給某人（允許再授權）
GRANT SELECT ON shop_db.* TO 'manager'@'localhost' WITH GRANT OPTION;
```

#### 🔹 3. 收回權限
```sql
REVOKE INSERT ON shop_db.* FROM 'app_user'@'localhost';
```

#### 🔹 4. 刪除使用者
```sql
DROP USER 'app_user'@'localhost';
```

---

### 🧪 四、練習題範例

1. **給某個使用者僅能查詢 `employees` 表：**
```sql
GRANT SELECT ON company.employees TO 'report_user'@'localhost';
```

2. **給某個使用者能建立資料表但不能刪除：**
```sql
GRANT CREATE ON accounting_db.* TO 'dev_user'@'localhost';
```

3. **授予某人可執行函式與修改資料：**
```sql
GRANT EXECUTE, UPDATE ON *.* TO 'ops_user'@'localhost';
```

---

### 🧭 小提醒：檢查權限

使用以下指令可檢查使用者權限：
```sql
SHOW GRANTS FOR 'user'@'host';
```

---

## 2.2 授予权限的原则
> 权限控制主要是出于安全因素，因此需要遵循以下几个经验原则：

- 只授予能满足需要的最小权限，防止用户干坏事。比如用户只是需要查询，那就只给select权限就可以了，不要给用户赋予update、insert或者delete权限。

- 创建用户的时候限制用户的登录主机，一般是限制成指定IP或者内网IP段。

- 为每个用户设置满足密码复杂度的密码。

- 定期清理不需要的用户，回收权限或者删除用户。

## 2.3 授予权限
### 🔐 一、MySQL 授權方式的兩大類型
> 给用户授权的方式有 2 种，分别是通过把 **角色赋予** 和 **直接给用户授权** 。用户是数据库的使用者，我们可以通过给用户授予访问数据库中资源的权限，来控制使用者对数据库的访问，消除安全隐患。

#### ✅ 1. **直接授權給使用者（常見方式）**
最常見的授權方式，直接對使用者賦予權限。

```sql
GRANT SELECT, INSERT ON database.table TO 'user'@'host';
```

#### ✅ 2. **使用角色授權（MySQL 8.0+）**
先建立角色，再把角色授予使用者，達成權限統一管理。

```sql
-- 建立角色
CREATE ROLE 'readonly';

-- 給角色授權
GRANT SELECT ON mydb.* TO 'readonly';

-- 將角色賦予使用者
GRANT 'readonly' TO 'bob'@'%';

-- 啟用角色（登入後）
SET ROLE 'readonly';
```

---

### 📚 二、`GRANT` 語法結構補充解釋

```sql
GRANT 權限1, 權限2, ... ON 資料庫.資料表 TO '使用者'@'主機'
[IDENTIFIED BY '密碼']
[WITH GRANT OPTION];
```

| 語法項目             | 說明 |
|----------------------|------|
| `權限1, 權限2...`     | 指定要授予的權限，例如 SELECT、INSERT 等 |
| `資料庫.資料表`      | 指定授權對象，可使用 `*.*` 表示所有庫所有表 |
| `'使用者'@'主機'`    | 指定帳號與可登入來源，例如 `'joe'@'%'` |
| `IDENTIFIED BY`     | 如未存在此使用者則會自動建立並設定密碼 |
| `WITH GRANT OPTION` | 允許該使用者將自己擁有的權限再授予他人 |

---

### 🧪 三、實務授權範例

#### 🌟 1. 指定資料庫的讀寫權限

```sql
-- 給 'dev_user' 從本機登入者，在 atguigudb 資料庫中 SELECT、INSERT、UPDATE、DELETE 權限
GRANT SELECT, INSERT, UPDATE, DELETE ON atguigudb.* TO 'dev_user'@'localhost' IDENTIFIED BY 'devpass';
```

#### 🌍 2. 允許任何來源登入並擁有所有權限（不含GRANT）

```sql
GRANT ALL PRIVILEGES ON *.* TO 'admin'@'%' IDENTIFIED BY 'admin123';
```

#### 🛠 3. 授權後再補加其他權限（會疊加）

```sql
-- 初始授權 SELECT 權限
GRANT SELECT ON salesdb.* TO 'analyst'@'192.168.1.%';

-- 後續補加 INSERT 權限
GRANT INSERT ON salesdb.* TO 'analyst'@'192.168.1.%';
```

#### 🔑 4. 使用 WITH GRANT OPTION 授權再授權

```sql
-- 'manager' 擁有完整權限，並可將其權限再授予他人
GRANT ALL PRIVILEGES ON projectdb.* TO 'manager'@'%' IDENTIFIED BY 'm456' WITH GRANT OPTION;
```

---

### 📊 四、橫向 vs 縱向授權解釋

| 類型 | 說明 | 舉例 |
|------|------|------|
| **橫向分組** | 決定使用者可接觸的資料範圍 | A只能看`salesdb.*`，B只能看`marketingdb.*` |
| **縱向分組** | 決定使用者可對資料做什麼動作 | C可看、改資料（SELECT/UPDATE），D只能看（SELECT） |

**範例：**

```sql
-- 橫向控制: user_a 只能查詢 salesdb
GRANT SELECT ON salesdb.* TO 'user_a'@'localhost';

-- 縱向控制: user_b 對 marketingdb.users 具有增刪查權限
GRANT SELECT, INSERT, DELETE ON marketingdb.users TO 'user_b'@'localhost';
```

---

### 🧹 五、安全與管理建議

1. **最小權限原則**：只授予業務需要的最小權限。
2. **分主機授權**：根據 IP 來源授權，避免濫用。
3. **避免濫用 `WITH GRANT OPTION`**：僅授予受信任的管理帳號。
4. **定期檢查與回收權限**：
   ```sql
   SHOW GRANTS FOR 'user'@'host';
   REVOKE ALL PRIVILEGES, GRANT OPTION FROM 'user'@'host';
   ```

---

## 2.4 查看权限
### 查看当前用户权限
```sql
SHOW GRANTS; 
# 或 
SHOW GRANTS FOR CURRENT_USER; 
# 或 
SHOW GRANTS FOR CURRENT_USER();
```

### 查看某用户的全局权限
```sql
SHOW GRANTS FOR 'user'@'主机地址';
```

## 2.5 收回權限
### 🔐 一、REVOKE 是什麼？

`REVOKE` 用於 **撤銷使用者的權限**。常見用途包括：
- 移除不再需要的操作權限（如 INSERT、DELETE）
- 在帳號保留但限制操作範圍的情況下
- 降低使用者帳號造成破壞的風險

---

### 📚 二、REVOKE 語法

```sql
REVOKE 權限1, 權限2, ... ON 資料庫.資料表 FROM '使用者'@'主機';
```

| 語法項目 | 說明 |
|----------|------|
| `權限1, 權限2...` | 欲撤銷的權限，可為 `SELECT`、`ALL PRIVILEGES` 等 |
| `資料庫.資料表` | 欲撤銷的範圍，例如 `mydb.users` 或 `*.*` |
| `'使用者'@'主機'` | 目標帳號與來源，例如 `'joe'@'%'` |

---

### 🧪 三、實務範例

#### ✅ 1. 撤銷對某個資料庫的基本操作權限
```sql
REVOKE SELECT, INSERT, UPDATE, DELETE ON salesdb.* FROM 'sales_user'@'localhost';
```

#### ✅ 2. 撤銷所有庫、所有表的所有權限（但不刪帳號）
```sql
REVOKE ALL PRIVILEGES ON *.* FROM 'admin'@'%';
```

#### ✅ 3. 收回儲存程序的執行權限
```sql
REVOKE EXECUTE ON PROCEDURE report_db.generate_monthly_report FROM 'report_user'@'192.168.1.%';
```

#### ✅ 4. 收回 WITH GRANT OPTION 權限（單獨移除再授權能力）
```sql
REVOKE GRANT OPTION ON hrdb.* FROM 'hr_mgr'@'localhost';
```

---

### 🔍 四、REVOKE 生效機制與注意事項

| 項目 | 說明 |
|------|------|
| 生效時機 | 須「重新登入」帳號後生效（MySQL 缓存權限） |
| 不會刪帳號 | `REVOKE` 不會刪除使用者，只是移除其操作權限 |
| 刪除帳號 | 若要徹底移除帳號，請使用 `DROP USER` |
| 權限分散 | 權限可來自多個 `GRANT`，撤銷時需指定完整範圍與來源 |

#### 🔥 補充錯誤處理
有時會出現錯誤：
```sql
ERROR 1227 (42000): Access denied; you need (at least one of) the SYSTEM_USER privilege(s) for this operation
```
解決方式：
```sql
GRANT SYSTEM_USER ON *.* TO 'root'@'localhost';
```
（或使用擁有該權限的帳號操作）

---

### 🛠 五、移除帳號的完整流程（建議做法）

1. **先查出其所有授權內容**
```sql
SHOW GRANTS FOR 'user'@'host';
```

2. **逐項使用 `REVOKE` 收回權限**
```sql
REVOKE ALL PRIVILEGES, GRANT OPTION ON *.* FROM 'user'@'host';
```

3. **最後刪除帳號**
```sql
DROP USER 'user'@'host';
```

---

### 🧠 六、最佳實務建議

| 建議 | 說明 |
|------|------|
| ✅ 使用最小權限原則 | 僅授與業務所需權限，避免 `ALL PRIVILEGES` |
| ✅ 避免硬編碼 root 密碼 | 不建議將 root 密碼寫死在程式中，應使用專用帳號 |
| ✅ 定期審查與回收權限 | 例如員工離職、職務異動時撤權限 |
| ✅ 用角色統一管理（MySQL 8.0+） | 利於權限批量分配與回收 |

---

# 3. 